// Image Select, an extention to the Chosen, a Select Box Enhancer for jQuery and Prototype
// by Adnan Sagar, WebSemantics Inc. http://websemantics.ca & AlterSpark Corp. http://www.alterspark.com/
//
// Version 1.3
// Full source at https://github.com/harvesthq/chosen
// Copyright (c) 2014 WebSemantics http://websemantics.ca

// MIT License, https://github.com/websemantics/Image-Select/blob/master/LICENSE

(function(a){var p=a.fn.chosen;a.fn.extend({chosen:function(n){n=n||{};var m=n.html_template||'<img class="{class_name}" src="{url}" />';this.each(function(l){$this=a(this);$this.on("chosen:ready",function(f,k){k=k.chosen;var g=k.form_field.options,b=a(k.container).find(".chosen-choices span");if(g&&g.length)for(var h=0;h<g.length;h++){var c=g[h],e=a(c).attr("selected"),d=a(c).attr("data-img-src"),c=a(c).text();if(e&&d)if(e=m.replace("{url}",d),b.length)for(d=0;d<b.length;d++)c==a(b[d]).text()&&a(b[d]).prepend(e.replace("{class_name}",
"chose-image"));else a(k.container).find(".chosen-single span").prepend(e.replace("{class_name}","chose-image-small"))}})});var q=p.apply(this,arguments);this.each(function(l){var f;l=a(this);f=l.data("chosen");l.on("change",function(k,g){var b=f.form_field.options;if(void 0!=g&&void 0!=g.selected&&b&&b.length)for(var h=0;h<b.length;h++){var c=b[h],e=a(c).attr("value")?a(c).attr("value"):a(c).text(),c=a(c).attr("data-img-src");void 0!=c&&g.selected==e&&(e=m.replace("{url}",c),span=a(f.container).find(".chosen-choices span").last(),
span.find("img").remove(),span.prepend(e.replace("{class_name}","chose-image")),span=a(f.container).find(".chosen-single span"),span.find("img").remove(),span.prepend(e.replace("{class_name}","chose-image-small")))}});l.on("chosen:hiding_dropdown",function(k,g){var b=a(f.form_field).find(":selected");b&&(b=b.attr("data-img-src"))&&(b=m.replace("{url}",b),span=a(f.container).find(".chosen-choices span").last(),span.find("img").remove(),span.prepend(b.replace("{class_name}","chose-image")),span=a(f.container).find(".chosen-single span"),
span.find("img").remove(),span.prepend(b.replace("{class_name}","chose-image-small")))});l.on("chosen:showing_dropdown",function(k,g){for(var b=a(f.container).find(".chosen-drop ul li:not(:has(img))"),h=a(f.form_field).find("optgroup, option"),c=0;c<b.length;c++){var e=b[c],d=a(h[c]).attr("data-img-src");void 0!=d&&(d=m.replace("{url}",d),a(e).prepend(d.replace("{class_name}","chose-image-list")))}})});$this.trigger("chosen:hiding_dropdown");return q}})})(jQuery);
